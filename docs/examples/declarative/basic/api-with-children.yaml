# API with nested child resources example
# This demonstrates the parent-child relationship structure for APIs

# Required portals for the API publications
portals:
  - ref: developer-portal
    name: "Developer Portal"
    description: "Public developer portal"
    
  #- ref: partner-portal
  #  name: "Partner Portal"
  #  description: "Partner-only portal"

# Required auth strategies for the API publications
application_auth_strategies:
  #- ref: oauth-strategy
  #  name: "OAuth Strategy"
  #  display_name: "OAuth 2.0"
  #  strategy_type: key_auth
  #  configs:
  #    key_auth:
  #      key_names: ["api-key"]
        
  - ref: key-auth-strategy
    name: "API Key Strategy"
    display_name: "API Key Auth"
    strategy_type: key_auth
    configs:
      key_auth:
        key_names: ["x-api-key"]

apis:
  - ref: payment-api
    name: "Payment Processing API"
    description: "API for processing payments and transactions"
    
    # Nested API versions
    versions:
      - ref: payment-api-v1
        name: "v1.0.0"
        version: "1.0.0"
        spec:
          openapi: 3.0.0
          info:
            title: Simple Payment API
            version: 1.0.0
            description: simple API for processing payments
          paths:
            /payments:
              post:
                summary: Process a payment

    
    # Nested API publications
    #publications:
    #  - ref: payment-api-pub-dev-portal
    #    portal_id: developer-portal  # References portal by ref
    #    publish_status: "published"
    #    auth_strategy_ids:
    #      - key-auth-strategy
    #    auto_approve_applications: true
    #    auto_approve_registrations: false
    #    
    #  - ref: payment-api-pub-partner-portal
    #    portal_id: partner-portal
    #    publish_status: "published"
    #    auth_strategy_ids:
    #      - oauth-strategy
    #    auto_approve_applications: false
    #    auto_approve_registrations: false
    #    application_registration_enabled: true
        
    # Nested API implementations
    #implementations:
    #  - ref: payment-api-impl-prod
    #    implementation_url: "https://api.example.com/payments/v2"
    #    service:
    #      id: "d125e0a1-b305-4ae2-9fa8-3a57f9df85e1"  # External UUID from decK
    #      control_plane_id: test-cp  # References control plane by ref
    #    
    #  - ref: payment-api-impl-staging
    #    implementation_url: "https://api-staging.example.com/payments/v2"
    #    service:
    #      id: "a8b7c6d5-4321-1234-5678-9abcdef01234"  # External UUID from decK
    #      control_plane_id: test-cp
