# API lifecycle management example
# This demonstrates managing multiple versions, publications, and implementations

apis:
  - ref: notification-api
    name: "Notification Service API"
    description: "Multi-channel notification delivery API"
    
    # Multiple versions showing lifecycle progression
    versions:
      - ref: notification-v1
        name: "v1.0.0"
        version: "v1"
        description: "Initial release - Email only"
        publish_status: "deprecated"
        deprecated: true
        sunset_date: "2024-12-31"
        
      - ref: notification-v1-1
        name: "v1.1.0"
        version: "v1.1"
        description: "Added SMS support"
        publish_status: "deprecated"
        deprecated: true
        sunset_date: "2025-03-31"
        
      - ref: notification-v2
        name: "v2.0.0"
        version: "v2"
        description: "Current stable - Email, SMS, Push notifications"
        publish_status: "published"
        
      - ref: notification-v3-beta
        name: "v3.0.0-beta.1"
        version: "v3-beta"
        description: "Beta - Added webhook and Slack integration"
        publish_status: "published"
        
      - ref: notification-v3-alpha
        name: "v3.0.0-alpha.1"
        version: "v3-alpha"
        description: "Alpha - Experimental features"
        publish_status: "unpublished"
    
    # Multiple publications for different audiences
    publications:
      # Public portal - only stable versions
      - ref: notification-public-pub
        portal_id: public-developer-portal
        publish_status: "published"
        auth_strategy_ids:
          - public-oauth
          - api-key-basic
        auto_approve_applications: true
        auto_approve_registrations: true
        application_registration_enabled: true
        deprecated_version_ids:  # Only show current stable
          - notification-v1
          - notification-v1-1
        
      # Partner portal - stable and beta
      - ref: notification-partner-pub
        portal_id: partner-portal
        publish_status: "published"
        auth_strategy_ids:
          - partner-oauth
        auto_approve_applications: false
        auto_approve_registrations: false
        application_registration_enabled: true
        
      # Internal portal - all versions including alpha
      - ref: notification-internal-pub
        portal_id: internal-portal
        publish_status: "published"
        auth_strategy_ids:
          - internal-sso
        auto_approve_applications: true
        auto_approve_registrations: true
        application_registration_enabled: true
    
    # Multiple implementations across environments
    implementations:
      # Production implementations
      - ref: notification-prod-primary
        implementation_url: "https://api.company.com/notifications/v2"
        service:
          id: "n123e456-7890-1234-5678-90abcdef1234"
          control_plane_id: prod-primary
          
      - ref: notification-prod-secondary
        implementation_url: "https://api-dr.company.com/notifications/v2"
        service:
          id: "n456f789-0123-4567-8901-234567890abc"
          control_plane_id: prod-secondary
          
      # Beta implementation
      - ref: notification-beta
        implementation_url: "https://api-beta.company.com/notifications/v3-beta"
        service:
          id: "n789g012-3456-7890-1234-567890abcdef"
          control_plane_id: beta-environment
          
      # Development implementation
      - ref: notification-dev
        implementation_url: "https://api-dev.company.com/notifications/v3-alpha"
        service:
          id: "n012h345-6789-0123-4567-890123456789"
          control_plane_id: dev-environment

# Supporting resources referenced above
application_auth_strategies:
  - ref: public-oauth
    name: "Public OAuth"
    auth_type: openid_connect
    openid_connect:
      issuer: "https://auth.company.com/public"
      client_id: "public-api-client"
      client_secret: "${PUBLIC_OAUTH_SECRET}"
      scopes: ["openid", "profile", "email"]
      
  - ref: api-key-basic
    name: "Basic API Key"
    auth_type: key_auth
    key_auth:
      key_names: ["x-api-key"]
      key_source: "header"
      
  - ref: partner-oauth
    name: "Partner OAuth"
    auth_type: openid_connect
    openid_connect:
      issuer: "https://auth.company.com/partners"
      client_id: "partner-api-client"
      client_secret: "${PARTNER_OAUTH_SECRET}"
      scopes: ["openid", "profile", "email", "partner"]
      
  - ref: internal-sso
    name: "Internal SSO"
    auth_type: openid_connect
    openid_connect:
      issuer: "https://sso.internal.company.com"
      client_id: "internal-api-client"
      client_secret: "${INTERNAL_SSO_SECRET}"
      scopes: ["openid", "profile", "email", "groups"]

portals:
  - ref: public-developer-portal
    name: "Public Developer Portal"
    custom_domain: "developers.company.com"
    is_public: true
    default_application_auth_strategy_id: public-oauth
    
  - ref: partner-portal
    name: "Partner Portal"
    custom_domain: "partners.company.com"
    is_public: false
    default_application_auth_strategy_id: partner-oauth
    
  - ref: internal-portal
    name: "Internal API Portal"
    custom_domain: "api.internal.company.com"
    is_public: false
    default_application_auth_strategy_id: internal-sso

control_planes:
  - ref: prod-primary
    name: "Production Primary"
    cluster_type: "CLUSTER_TYPE_CONTROL_PLANE"
    labels:
      environment: "production"
      region: "us-east-1"
      role: "primary"
    kongctl:
      protected: true
      
  - ref: prod-secondary
    name: "Production Secondary (DR)"
    cluster_type: "CLUSTER_TYPE_CONTROL_PLANE"
    labels:
      environment: "production"
      region: "us-west-2"
      role: "disaster-recovery"
    kongctl:
      protected: true
      
  - ref: beta-environment
    name: "Beta Environment"
    cluster_type: "CLUSTER_TYPE_CONTROL_PLANE"
    labels:
      environment: "beta"
      region: "us-east-1"
      
  - ref: dev-environment
    name: "Development Environment"
    cluster_type: "CLUSTER_TYPE_CONTROL_PLANE"
    labels:
      environment: "development"
      region: "us-east-1"