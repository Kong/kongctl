# Multi-resource configuration example
# This demonstrates multiple resource types in a single file with proper structure

# Authentication strategies used by portals
application_auth_strategies:
  - ref: standard-oauth
    name: "Standard OAuth 2.0"
    display_name: "Standard OAuth 2.0"
    strategy_type: openid_connect
    configs:
      openid_connect:
        issuer: "https://auth.company.com"
        client_id: "portal-app"
        client_secret: "${OAUTH_SECRET}"
        scopes: ["openid", "profile", "email"]

# Portals for different audiences with proper parent-child structure
portals:
  - ref: public-developer-portal
    name: "Public Developer Portal"
    description: "Portal for external developers"
    authentication_enabled: true
    rbac_enabled: false
    default_api_visibility: "public"
    default_page_visibility: "public"
    default_application_auth_strategy_id: standard-oauth
    auto_approve_developers: true
    auto_approve_applications: false
    
    # Portal customization
    customization:
      theme:
        name: "public-theme"
        mode: "light"
        colors:
          primary: "#0066CC"
      css: |
        .header { background-color: #0066CC; }
      menu:
        main:
          - path: "/docs"
            title: "Documentation"
            visibility: "public"
            external: false
    
    # Custom domain
    custom_domain:
      hostname: "developers.company.com"
      enabled: true
      ssl:
        cert: "${PUBLIC_SSL_CERT}"
        key: "${PUBLIC_SSL_KEY}"
    
    # Basic pages
    pages:
      - ref: public-home
        title: "Welcome"
        path: "/"
        content: |
          # Welcome to our Developer Portal
          
          Access our public APIs and build amazing applications.
        visibility: "public"
        
  - ref: internal-api-portal
    name: "Internal API Portal"
    description: "Portal for internal teams"
    authentication_enabled: true
    rbac_enabled: true
    default_api_visibility: "private"
    default_page_visibility: "private"
    default_application_auth_strategy_id: standard-oauth
    auto_approve_developers: true
    auto_approve_applications: true
    
    # Portal customization
    customization:
      theme:
        name: "internal-theme"
        mode: "dark"
        colors:
          primary: "#1E40AF"
      menu:
        main:
          - path: "/docs"
            title: "API Docs"
            visibility: "private"
            external: false
          - path: "/admin"
            title: "Admin"
            visibility: "private"
            external: false
    
    # Custom domain
    custom_domain:
      hostname: "api.internal.company.com"
      enabled: true
      ssl:
        cert: "${INTERNAL_SSL_CERT}"
        key: "${INTERNAL_SSL_KEY}"
    
    # Internal pages
    pages:
      - ref: internal-home
        title: "Internal API Portal"
        path: "/"
        content: |
          # Internal API Portal
          
          Access internal services and microservices APIs.
        visibility: "private"

# Control planes for different environments
control_planes:
  - ref: prod-us-west
    name: "Production US West"
    cluster_type: "CLUSTER_TYPE_CONTROL_PLANE"
    labels:
      environment: "production"
      region: "us-west-2"
      tier: "premium"
    kongctl:
      protected: true  # Prevent accidental deletion
      
  - ref: prod-eu-west
    name: "Production EU West"
    cluster_type: "CLUSTER_TYPE_CONTROL_PLANE"
    labels:
      environment: "production"
      region: "eu-west-1"
      tier: "premium"
    kongctl:
      protected: true

# APIs with minimal child resources (more can be added later)
apis:
  - ref: user-service-api
    name: "User Service API"
    description: "API for user management operations"
    
    versions:
      - ref: user-service-v1
        name: "v1.0.0"
        version: "v1"
        publish_status: "published"
        
    publications:
      - ref: user-service-public-pub
        portal_id: public-developer-portal
        publish_status: "published"
        auth_strategy_ids: [standard-oauth]
      
      - ref: user-service-internal-pub
        portal_id: internal-api-portal
        publish_status: "published"
        auth_strategy_ids: [standard-oauth]
        auto_approve_applications: true
        
    implementations:
      - ref: user-service-us-impl
        implementation_url: "https://api-us.company.com/users/v1"
        service:
          id: "u123e456-7890-1234-5678-90abcdef1234"
          control_plane_id: prod-us-west
          
      - ref: user-service-eu-impl
        implementation_url: "https://api-eu.company.com/users/v1"
        service:
          id: "u456f789-0123-4567-8901-234567890abc"
          control_plane_id: prod-eu-west