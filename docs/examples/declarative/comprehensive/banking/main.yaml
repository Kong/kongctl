# Comprehensive Banking API Example
# This example demonstrates ALL features of the declarative configuration
# for a real-world banking API with extensive use of !file tags

# Portal configuration for the banking developer portal
portals:
  - ref: securebank-portal
    name: securebank-developer-portal
    display_name: SecureBank Developer Portal
    description: Official developer portal for SecureBank API integration
    authentication_enabled: true
    rbac_enabled: true
    auto_approve_developers: false
    auto_approve_applications: false
    is_public: true
    labels:
      industry: financial-services
      compliance: pci-dss
      environment: production
      team: platform-engineering
    kongctl:
      protected: true  # Prevent accidental deletion

# Authentication strategies for API access
application_auth_strategies:
  - ref: securebank-oauth2-strategy
    name: securebank-oauth2
    display_name: OAuth 2.0 Authentication
    description: OAuth 2.0 with authorization code flow for user-authorized applications
    strategy_type: openid_connect
    configs:
      openid_connect:
        issuer: https://auth.securebank.com/
        scopes:
          - openid
          - profile
          - email
          - read
          - write
        auth_methods:
          - client_credentials
          - authorization_code
          - refresh_token
    labels:
      auth_type: oauth2
      user_facing: "true"
    
  - ref: securebank-apikey-strategy
    name: securebank-api-key
    display_name: API Key Authentication
    description: API key authentication for machine-to-machine integrations
    strategy_type: key_auth
    configs:
      key_auth:
        key_names:
          - X-API-Key
          - Api-Key
    labels:
      auth_type: api-key
      use_case: m2m

# Main API configuration with all features
apis:
  - ref: securebank-api
    # Load metadata from OpenAPI spec using !file tags
    name: !file specs/openapi.yaml#info.title
    description: !file specs/openapi.yaml#info.description
    version: !file specs/openapi.yaml#info.version
    labels:
      # Static labels
      team: platform-api
      product: core-banking
      criticality: high
      # Dynamic labels from OpenAPI spec
      license: !file specs/openapi.yaml#info.license.name
    kongctl:
      protected: false  # Allow updates during development

    # API Versions - showing different states and configurations
    versions:
      - ref: securebank-version-v1
        version: "1.0.0"
        spec: !file specs/openapi-v1.yaml
        
      # Current stable version
      - ref: securebank-version-v2
        version: !file specs/openapi.yaml#info.version
        # Load entire OpenAPI specification
        spec: !file specs/openapi.yaml
        
      # Beta version for early access
      - ref: securebank-version-v3-beta
        version: "3.0.0-beta.1"
        spec: !file specs/openapi-v3-beta.yaml

    # API Publications - different visibility and auth requirements
    publications:
      # Public publication for external developers
      - ref: securebank-public-publication
        portal_id: securebank-portal
        visibility: public
        auth_strategy_ids:
          - securebank-oauth2-strategy
          - securebank-apikey-strategy
        auto_approve_registrations: false
        auto_approve_applications: false
        application_registration_enabled: true
        
    # API Documents - comprehensive documentation
    documents:
      - ref: auth-guide
        title: Authentication Guide
        slug: authentication
        status: published
        # Load content from markdown file
        content: !file docs/authentication.md
        
      - ref: rate-limits-doc
        title: Rate Limiting Documentation
        slug: rate-limits
        status: published
        content: !file docs/rate-limits.md
        
      - ref: migration-guide
        title: "Migration Guide: v1 to v2"
        slug: migration-v1-v2
        status: published
        content: !file docs/migration-v1-v2.md
        
      - ref: api-changelog
        title: API Changelog
        slug: changelog
        status: published
        # Example of inline content for shorter documents
        content: |
          # SecureBank API Changelog
          
          ## Version 2.0.0 (2024-01-15)
          ### Breaking Changes
          - Removed HTTP Basic Authentication
          - Changed date format to ISO 8601
          - Restructured error responses
          
          ### New Features
          - Added batch payment endpoints
          - Introduced webhook support
          - Enhanced OAuth 2.0 scopes
          
          ### Improvements
          - 50% faster response times
          - Improved error messages
          - Added request ID tracking
          
          ## Version 1.5.0 (2023-10-01)
          ### Features
          - Added transaction categorization
          - Introduced spending insights endpoint
          
          ## Version 1.0.0 (2023-01-01)
          - Initial release

      - ref: quickstart
        title: Quick Start Guide
        slug: quickstart
        status: published
        content: |
          # Quick Start Guide
          
          Get started with SecureBank API in 5 minutes!
          
          ## 1. Get Your API Key
          Sign up at https://developer.securebank.com
          
          ## 2. Make Your First Request
          ```bash
          curl https://api.securebank.com/v2/accounts \
            -H "X-API-Key: YOUR_API_KEY"
          ```
          
          ## 3. Explore the API
          - View full API reference
          - Try our interactive console
          - Download SDK for your language
          
          ## Need Help?
          - Email: api-support@securebank.com
          - Documentation: https://docs.securebank.com
          - Status: https://status.securebank.com
